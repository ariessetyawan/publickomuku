(function(){function t(){}function e(t,e){for(var i=t.length;i--;)if(t[i].listener===e)return i;return-1}function i(t){return function(){return this[t].apply(this,arguments)}}var n=t.prototype,o=this,r=o.EventEmitter;n.getListeners=function(t){var e,i,n=this._getEvents();if("object"==typeof t){e={};for(i in n)n.hasOwnProperty(i)&&t.test(i)&&(e[i]=n[i])}else e=n[t]||(n[t]=[]);return e},n.flattenListeners=function(t){var e,i=[];for(e=0;t.length>e;e+=1)i.push(t[e].listener);return i},n.getListenersAsObject=function(t){var e,i=this.getListeners(t);return i instanceof Array&&(e={},e[t]=i),e||i},n.addListener=function(t,i){var n,o=this.getListenersAsObject(t),r="object"==typeof i;for(n in o)o.hasOwnProperty(n)&&-1===e(o[n],i)&&o[n].push(r?i:{listener:i,once:!1});return this},n.on=i("addListener"),n.addOnceListener=function(t,e){return this.addListener(t,{listener:e,once:!0})},n.once=i("addOnceListener"),n.defineEvent=function(t){return this.getListeners(t),this},n.defineEvents=function(t){for(var e=0;t.length>e;e+=1)this.defineEvent(t[e]);return this},n.removeListener=function(t,i){var n,o,r=this.getListenersAsObject(t);for(o in r)r.hasOwnProperty(o)&&(n=e(r[o],i),-1!==n&&r[o].splice(n,1));return this},n.off=i("removeListener"),n.addListeners=function(t,e){return this.manipulateListeners(!1,t,e)},n.removeListeners=function(t,e){return this.manipulateListeners(!0,t,e)},n.manipulateListeners=function(t,e,i){var n,o,r=t?this.removeListener:this.addListener,s=t?this.removeListeners:this.addListeners;if("object"!=typeof e||e instanceof RegExp)for(n=i.length;n--;)r.call(this,e,i[n]);else for(n in e)e.hasOwnProperty(n)&&(o=e[n])&&("function"==typeof o?r.call(this,n,o):s.call(this,n,o));return this},n.removeEvent=function(t){var e,i=typeof t,n=this._getEvents();if("string"===i)delete n[t];else if("object"===i)for(e in n)n.hasOwnProperty(e)&&t.test(e)&&delete n[e];else delete this._events;return this},n.removeAllListeners=i("removeEvent"),n.emitEvent=function(t,e){var i,n,o,r,s=this.getListenersAsObject(t);for(o in s)if(s.hasOwnProperty(o))for(n=s[o].length;n--;)i=s[o][n],i.once===!0&&this.removeListener(t,i.listener),r=i.listener.apply(this,e||[]),r===this._getOnceReturnValue()&&this.removeListener(t,i.listener);return this},n.trigger=i("emitEvent"),n.emit=function(t){var e=Array.prototype.slice.call(arguments,1);return this.emitEvent(t,e)},n.setOnceReturnValue=function(t){return this._onceReturnValue=t,this},n._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},n._getEvents=function(){return this._events||(this._events={})},t.noConflict=function(){return o.EventEmitter=r,t},"function"==typeof define&&define.amd?define("eventEmitter/EventEmitter",[],function(){return t}):"object"==typeof module&&module.exports?module.exports=t:this.EventEmitter=t}).call(this),function(t){function e(e){var i=t.event;return i.target=i.target||i.srcElement||e,i}var i=document.documentElement,n=function(){};i.addEventListener?n=function(t,e,i){t.addEventListener(e,i,!1)}:i.attachEvent&&(n=function(t,i,n){t[i+n]=n.handleEvent?function(){var i=e(t);n.handleEvent.call(n,i)}:function(){var i=e(t);n.call(t,i)},t.attachEvent("on"+i,t[i+n])});var o=function(){};i.removeEventListener?o=function(t,e,i){t.removeEventListener(e,i,!1)}:i.detachEvent&&(o=function(t,e,i){t.detachEvent("on"+e,t[e+i]);try{delete t[e+i]}catch(n){t[e+i]=void 0}});var r={bind:n,unbind:o};"function"==typeof define&&define.amd?define("eventie/eventie",r):t.eventie=r}(this),function(t,e){"function"==typeof define&&define.amd?define(["eventEmitter/EventEmitter","eventie/eventie"],function(i,n){return e(t,i,n)}):"object"==typeof exports?module.exports=e(t,require("wolfy87-eventemitter"),require("eventie")):t.imagesLoaded=e(t,t.EventEmitter,t.eventie)}(window,function(t,e,i){function n(t,e){for(var i in e)t[i]=e[i];return t}function o(t){return"[object Array]"===u.call(t)}function r(t){var e=[];if(o(t))e=t;else if("number"==typeof t.length)for(var i=0,n=t.length;n>i;i++)e.push(t[i]);else e.push(t);return e}function s(t,e,i){if(!(this instanceof s))return new s(t,e);"string"==typeof t&&(t=document.querySelectorAll(t)),this.elements=r(t),this.options=n({},this.options),"function"==typeof e?i=e:n(this.options,e),i&&this.on("always",i),this.getImages(),c&&(this.jqDeferred=new c.Deferred);var o=this;setTimeout(function(){o.check()})}function a(t){this.img=t}function h(t){this.src=t,l[t]=this}var c=t.jQuery,f=t.console,p=void 0!==f,u=Object.prototype.toString;s.prototype=new e,s.prototype.options={},s.prototype.getImages=function(){this.images=[];for(var t=0,e=this.elements.length;e>t;t++){var i=this.elements[t];"IMG"===i.nodeName&&this.addImage(i);var n=i.nodeType;if(n&&(1===n||9===n||11===n))for(var o=i.querySelectorAll("img"),r=0,s=o.length;s>r;r++){var a=o[r];this.addImage(a)}}},s.prototype.addImage=function(t){var e=new a(t);this.images.push(e)},s.prototype.check=function(){function t(t,o){return e.options.debug&&p&&f.log("confirm",t,o),e.progress(t),i++,i===n&&e.complete(),!0}var e=this,i=0,n=this.images.length;if(this.hasAnyBroken=!1,!n)return void this.complete();for(var o=0;n>o;o++){var r=this.images[o];r.on("confirm",t),r.check()}},s.prototype.progress=function(t){this.hasAnyBroken=this.hasAnyBroken||!t.isLoaded;var e=this;setTimeout(function(){e.emit("progress",e,t),e.jqDeferred&&e.jqDeferred.notify&&e.jqDeferred.notify(e,t)})},s.prototype.complete=function(){var t=this.hasAnyBroken?"fail":"done";this.isComplete=!0;var e=this;setTimeout(function(){if(e.emit(t,e),e.emit("always",e),e.jqDeferred){var i=e.hasAnyBroken?"reject":"resolve";e.jqDeferred[i](e)}})},c&&(c.fn.imagesLoaded=function(t,e){var i=new s(this,t,e);return i.jqDeferred.promise(c(this))}),a.prototype=new e,a.prototype.check=function(){var t=l[this.img.src]||new h(this.img.src);if(t.isConfirmed)return void this.confirm(t.isLoaded,"cached was confirmed");if(this.img.complete&&void 0!==this.img.naturalWidth)return void this.confirm(0!==this.img.naturalWidth,"naturalWidth");var e=this;t.on("confirm",function(t,i){return e.confirm(t.isLoaded,i),!0}),t.check()},a.prototype.confirm=function(t,e){this.isLoaded=t,this.emit("confirm",this,e)};var l={};return h.prototype=new e,h.prototype.check=function(){if(!this.isChecked){var t=new Image;i.bind(t,"load",this),i.bind(t,"error",this),t.src=this.src,this.isChecked=!0}},h.prototype.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},h.prototype.onload=function(t){this.confirm(!0,"onload"),this.unbindProxyEvents(t)},h.prototype.onerror=function(t){this.confirm(!1,"onerror"),this.unbindProxyEvents(t)},h.prototype.confirm=function(t,e){this.isConfirmed=!0,this.isLoaded=t,this.emit("confirm",this,e)},h.prototype.unbindProxyEvents=function(t){i.unbind(t.target,"load",this),i.unbind(t.target,"error",this)},s}),function(){function t(){return"ontouchstart"in window||"onmsgesturechange"in window}function e(t,e,i){return i>t+e&&(t=i-e),t>0?0:t}function i(t){for(var e=t.split(","),i=atob(e[1]),n=e[0].split(":")[1].split(";")[0],o=new ArrayBuffer(i.length),r=new Uint8Array(o),s=0;s<i.length;s++)r[s]=i.charCodeAt(s);return new Blob([o],{type:n})}function n(n){function s(t,e,i){this.width=null,this.height=null,this.img_width=null,this.img_height=null,this.img_left=0,this.img_top=0,this.minPercent=null,this.options=e,this.$image=t,this.$image.hide().prop("draggable",!1).addClass("cropImage").wrap('<div class="cropFrame" />'),this.$frame=this.$image.parent(),this.on_load=i||function(){},this.init()}s.prototype={init:function(){var t=this,e=n("<div/>",{"class":"cropControls"}).append(n("<span>"+this.options.label+"</span>")).append(n("<button/>",{"class":"cropZoomIn",type:"button"}).on("click",n.proxy(this.zoomIn,this))).append(n("<button/>",{"class":"cropZoomOut",type:"button"}).on("click",n.proxy(this.zoomOut,this)));if(this.$frame.append(this.options.controls||e),this.updateOptions(),"function"==typeof n.fn.hammer||"undefined"!=typeof Hammer){var i,o;i="function"==typeof n.fn.hammer?this.$image.hammer().data("hammer"):Hammer(this.$image.get(0)),i.get("pan").set({direction:Hammer.DIRECTION_ALL,threshold:0}),i.get("pinch").set({enable:!0}),i.on("panleft panright panup pandown",function(e){o||(o={startX:t.img_left,startY:t.img_top}),o.dx=e.deltaX,o.dy=e.deltaY,e.preventDefault(),t.drag.call(t,o,!0)}).on("panend pancancel",function(e){e.preventDefault(),o=null,t.update.call(t)}).on("doubletap",function(e){e.preventDefault(),t.zoomIn.call(t)}).on("pinchin",function(e){e.preventDefault(),t.zoomOut.call(t)}).on("pinchout",function(e){e.preventDefault(),t.zoomIn.call(t)})}else this.$image.on("dragstart",function(){return!1}),this.$image.on("mousedown."+r,function(e){var i={startX:t.img_left,startY:t.img_top};e.preventDefault(),n(document).on("mousemove."+r,function(n){i.dx=n.pageX-e.pageX,i.dy=n.pageY-e.pageY,t.drag.call(t,i,!0)}).on("mouseup."+r,function(){t.update.call(t),n(document).off("mouseup."+r),n(document).off("mousemove."+r)})});n.fn.mousewheel&&this.$image.on("mousewheel."+r,function(e){e.preventDefault(),e.deltaY<0?t.zoomIn.call(t):t.zoomOut.call(t)})},updateOptions:function(){var e=this;e.img_top=0,e.img_left=0,e.$image.css({width:"",left:e.img_left,top:e.img_top}),e.$frame.width(e.options.width).height(e.options.height),e.$frame.off("."+r),e.$frame.removeClass("hover"),"always"===e.options.showControls||"auto"===e.options.showControls&&t()?e.$frame.addClass("hover"):"never"!==e.options.showControls&&(e.$frame.on("mouseenter."+r,function(){e.$frame.addClass("hover")}),e.$frame.on("mouseleave."+r,function(){e.$frame.removeClass("hover")}));var i=new Image;i.onload=function(){e.width=i.width,e.height=i.height,i.src="",i.onload=null,e.percent=void 0,e.fit.call(e),e.options.result?e.setCrop.call(e,e.options.result):e.zoom.call(e,e.minPercent),e.$image.fadeIn("fast"),e.on_load.call(e)},i.src=e.$image.attr("src")},remove:function(){var t;"function"==typeof n.fn.hammer?t=this.$image.data("hammer"):"undefined"!=typeof Hammer&&(t=Hammer(this.$image.get(0))),t&&t.off("panleft panright panup pandown panend pancancel doubletap pinchin pinchout"),this.$frame.off("."+r),this.$image.off("."+r),this.$image.css({width:"",left:"",top:""}),this.$image.removeClass("cropImage"),this.$image.removeData(r),this.$image.insertAfter(this.$frame),this.$frame.removeClass("cropFrame"),this.$frame.removeAttr("style"),this.$frame.empty(),this.$frame.remove()},fit:function(){var t=this.options.width/this.width,e=this.options.height/this.height;this.minPercent=t>=e?t:e},setCrop:function(t){this.percent=Math.max(this.options.width/t.cropW,this.options.height/t.cropH),this.img_width=Math.ceil(this.width*this.percent),this.img_height=Math.ceil(this.height*this.percent),this.img_left=-Math.floor(t.cropX*this.percent),this.img_top=-Math.floor(t.cropY*this.percent),this.$image.css({width:this.img_width,left:this.img_left,top:this.img_top}),this.update()},zoom:function(t){var i=this.percent;if(this.percent=Math.max(this.minPercent,Math.min(this.options.maxZoom,t)),this.img_width=Math.ceil(this.width*this.percent),this.img_height=Math.ceil(this.height*this.percent),i){var n=this.percent/i;this.img_left=e((1-n)*this.options.width/2+n*this.img_left,this.img_width,this.options.width),this.img_top=e((1-n)*this.options.height/2+n*this.img_top,this.img_height,this.options.height)}else this.img_left=e((this.options.width-this.img_width)/2,this.img_width,this.options.width),this.img_top=e((this.options.height-this.img_height)/2,this.img_height,this.options.height);this.$image.css({width:this.img_width,left:this.img_left,top:this.img_top}),this.update()},zoomIn:function(){this.zoom(this.percent+(1-this.minPercent)/(this.options.zoom-1||1))},zoomOut:function(){this.zoom(this.percent-(1-this.minPercent)/(this.options.zoom-1||1))},drag:function(t,i){this.img_left=e(t.startX+t.dx,this.img_width,this.options.width),this.img_top=e(t.startY+t.dy,this.img_height,this.options.height),this.$image.css({left:this.img_left,top:this.img_top}),i||this.update()},update:function(){this.result={cropX:-Math.ceil(this.img_left/this.percent),cropY:-Math.ceil(this.img_top/this.percent),cropW:Math.floor(this.options.width/this.percent),cropH:Math.floor(this.options.height/this.percent),stretch:this.minPercent>1},this.$image.trigger(r,[this.result,this])},getDataURL:function(){if(!o)return!1;var t=document.createElement("canvas"),e=t.getContext("2d");return t.width=this.options.width,t.height=this.options.height,e.drawImage(this.$image.get(0),this.result.cropX,this.result.cropY,this.result.cropW,this.result.cropH,0,0,this.options.width,this.options.height),t.toDataURL()},getBlob:function(){return i(this.getDataURL())}},n.fn[r]=function(t,e){return this.each(function(){var i=n(this),o=i.data(r);if(o)t&&(n.extend(o.options,t),o.updateOptions());else{var a=n.extend({},n.fn[r].defaultOptions,t);i.data(r,new s(i,a,e))}})},n.fn[r].defaultOptions={width:200,height:200,zoom:10,maxZoom:1,controls:null,showControls:"auto",label:"Drag to crop"}}var o=document.createElement("canvas");o=!(!o.getContext||!o.getContext("2d"));var r="cropbox";"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?n(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],n):n(window.jQuery||window.Zepto)}(),!function(t,e,i,n){i.CoverBlock=function(i){t(window).on("resize orientationchange",function(){t(e).triggerHandler("renderCoverComponents")});var n,o,r;t(window).width();t(e).on("ready renderCoverComponents",function(e){n||(n=t(".primaryUserBlock .mainText")),o||(o=t('.avatarScaler img[itemprop="photo"]')),r||(r=t(".profilePage .section.infoBlock")),t(window).width()<700?(n.children().each(function(e,i){var n=t(i);n.hasClass("followBlock")||n.xfShow()}),o.xfShow(),r.length&&t(r[0]).css({marginTop:10}),i.find(".bottom").xfHide()):(n.children().each(function(e,i){var n=t(i);n.hasClass("followBlock")||n.xfHide()}),o.xfHide(),r.length&&t(r[0]).css({marginTop:0}),i.find(".bottom").xfShow())})},i.__crops=null,i.RepositionClickHandle=function(n){t(window).on("resize orientationchange",function(i){t(e).triggerHandler("renderCoverComponents")}),n.on("click",function(n){n.preventDefault();var o=t(n.currentTarget),r=t(o.data("target")),s=parseInt(r.data("height"))||350,a=parseInt(r.data("width"))||1024,h=r.find(".InProgress"),c=r.find(".ToggleTriggerAnchor"),f=r.find("#profileCover_actions");r.addClass("repositionCover"),h.xfShow(),c.xfHide(),f.xfHide(),r.find("img.coverPhoto").attr("src",r.data("source"));var p=t(".profileCover .inner>img");p.imagesLoaded(function(i){i.isComplete&&(t(e).triggerHandler("coverImageLoaded"),setTimeout(function(){u()},100))});var u=function(){h.xfHide();var n=t("<a />").attr("class","repositionButtonSave button").attr("href",e.URL+"#").text(r.data("buttontitle"));r.append(n),i.activate(r);var o;o=r.width()>=a?1:r.width()/a,l(o,r.width(),p),t(e).on("renderCoverComponents",function(t){var e;e=r.width()>=a?1:r.width()/a,l(e,r.width(),p)})},l=function(t,e,n){var o=t*s;n.cropbox({width:e,height:o,showControls:"never"}).on("cropbox",function(t,e){i.__crops=e,i.__crops.containerW=n.width()})}})},i.RepositionButtonSave=function(e){e.on("click",function(n){return n.preventDefault(),e.attr("disabled","disabled"),$container=t(".profileCover"),postURL=$container.data("save"),$InProgress=$container.find(".InProgress"),$InProgress.xfShow(),$container.removeClass("repositionCover"),postURL&&i.__crops?void i.ajax(postURL,i.__crops,function(n,o){if(i.__crops=null,$InProgress.xfHide(),i.hasResponseError(n))return!1;t(".cropFrame").remove();var r=t("<img />").attr({"class":"coverPhoto photo",src:n.result.cover});r.insertAfter(t(".profileCover .InProgress")),e.xfHide(),e.remove(),$container.find(".ToggleTriggerAnchor").xfShow(),$container.find("#profileCover_actions").removeClass("menuVisible"),i.activate($container)}):!1})},i.register(".profileCover","XenForo.CoverBlock"),i.register(".repositionClickHandle","XenForo.RepositionClickHandle"),i.register(".repositionButtonSave","XenForo.RepositionButtonSave")}(jQuery,document,XenForo);