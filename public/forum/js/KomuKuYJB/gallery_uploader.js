/* c1dcdc1153e2ddf304c75a5b70269c5793906bca
 * Part of 'GoodForNothing Classifieds' for XenForo
 * Copyright Â© 2012-2016 GoodForNothing Labs
 * Licensed under GoodForNothing Labs' license agreement: https://gfnlabs.com/legal/license
 */
!function(c,b,a,d){if(typeof KomuKuYJB=="undefined"){KomuKuYJB={}}KomuKuYJB.GalleryUploader=function(i){var h=XenForo.AttachmentUploader(i),n,l=c("#GalleryImageContainer_"+i.data("uploaderid")),g=c(".ClassifiedFeaturedIcon"),e=c(".ClassifiedFeaturedIconField"),f=function(o){l.removeClass("empty");var p='<div class="GalleryImage" id="galleryImage_'+o+'" data-file-id="'+o+'"><span class="FeatureButton"></span><span class="DeleteButton"></span><span class="ProgressBar"><span class="done"></span></span></div>';p=c(p);p.find(".DeleteButton").click(k);p.find(".FeatureButton").click(j);p.xfInsert("appendTo","#GalleryImageContainer_"+i.data("uploaderid"),"xfFadeIn");l.removeClass("empty");return p},k=function(q){q.preventDefault();var p=c(this),o=p.parent();if(p.data("href")){XenForo.ajax(p.data("href"),{},function(){o.xfRemove("xfFadeOut",function(){if(!l.find(".GalleryImage").length){l.addClass("empty")}})})}else{if(o.data("file-id")&&n){n.cancelUpload(o.data("file-id"));o.xfRemove("xfFadeOut",function(){if(!l.find(".GalleryImage").length){l.addClass("empty")}})}}},j=function(q){q.preventDefault();var p=c(this),o=p.parent();p.toggleClass("selected");o.siblings().find(".FeatureButton.selected").removeClass("selected");if(p.hasClass("selected")){g.css("background-image","url("+o.data("image-path")+")");e.val(o.data("attachment-id"))}else{g.css("background-image","url("+g.data("default-image")+")");e.val(0)}},m=function(p){var o="";if(p.ajaxData){c.each(p.ajaxData.error,function(r,q){o+=q+"\n"})}h.swfAlert(p.file,p.errorCode,o);c("#galleryImage_"+p.file.id).xfRemove("xfFadeOut",function(){if(!l.find(".GalleryImage").length){l.addClass("empty")}})};i.bind({AttachmentQueueValidation:function(o){n=o.swfUpload;if(!o.isImage){o.preventDefault();o.swfUpload.cancelUpload(o.file.id,false)}},AttachmentQueued:function(o){n=o.swfUpload;f(o.file.id)},AttachmentQueueError:m,AttachmentUploadError:m,AttachmentUploadProgress:function(p){n=p.swfUpload;console.log("Uploaded %d/%d bytes.",p.bytes,p.file.size);var o=Math.min(100,Math.ceil(p.bytes*100/p.file.size));c("#galleryImage_"+p.file.id).find(".ProgressBar > .done").css("width",o+"%")},AttachmentUploaded:function(q){n=q.swfUpload;var o;if(typeof q.file!="undefined"){o=c("#galleryImage_"+q.file.id)}else{o=f(q.ajaxData.template_id)}var p=q.ajaxData.slideUrl||q.ajaxData.thumbnailUrl||q.ajaxData.viewUrl;o.css("background-image","url("+p+")");o.find(".DeleteButton").attr("data-href",q.ajaxData.deleteUrl);o.find(".ProgressBar").xfFadeOut();o.data("image-path",p);o.data("attachment-id",q.ajaxData.attachment_id);o.addClass("loaded");if(e.val()==""||e.val()==0){o.find(".FeatureButton").trigger("click")}}});if(l.find(".GalleryImage.loaded").length){l.find(".GalleryImage.loaded .DeleteButton").click(k);l.find(".GalleryImage.loaded .FeatureButton").click(j)}};if(typeof XenForo.AttachmentUploader=="function"){XenForo.register(".GalleryUploader","KomuKuYJB.GalleryUploader")}}(jQuery,this,document);